--- a/luci-app-adguardhome/root/etc/init.d/AdGuardHome
+++ b/luci-app-adguardhome/root/etc/init.d/AdGuardHome
@@ -29,7 +29,7 @@ set_forward_dnsmasq()
 		if [ "$server" = "$addr" ]; then
 			continue
 		fi
-		uci add_list dhcp.@dnsmasq[0].server=$server
+		# uci add_list dhcp.@dnsmasq[0].server=$server
 	done
 	uci delete dhcp.@dnsmasq[0].resolvfile 2>/dev/null
 	uci set dhcp.@dnsmasq[0].noresolv=1
@@ -499,6 +499,14 @@ start_service() {
 	echo "AdGuardHome service enabled"
 	echo "luci enable switch=$enabled"
 	(sleep 10 && [ -z "$(pgrep $binpath)" ] && logger "AdGuardHome" "no process in 10s cancel redirect" && _do_redirect 0 )&
+	if [[ "`uci get bypass.@global[0].global_server 2>/dev/null`" && "`uci get bypass.@global[0].adguardhome 2>/dev/null`" == 1 && "$(uci get dhcp.@dnsmasq[0].port)" == "53" ]]; then
+		c1=0
+		while ! netstat -tunlp | grep 53 | grep -i AdGuardHome 2>&1; do
+			/etc/init.d/bypass restart 2>/dev/null
+			sleep 1
+			[ $c1 == 5 ] && break || let c1++
+		done
+	fi
 }
 
 reload_service()
@@ -539,11 +548,13 @@ stop_service()
 	fi
 	echo "AdGuardHome service disabled"
 	touch /var/run/AdGserverdis
+	killall -9 AdGuardHome 2>/dev/null
+	/etc/init.d/dnsmasq restart
 }
 
 boot() {
 	rc_procd boot_service "$@"
-	if eval "type service_started" 2>/dev/null >/dev/null; then
+	if eval "type service_started" 2>/dev/null; then
 		service_started
 	fi
 }

--- a/luci-app-adguardhome/Makefile
+++ b/luci-app-adguardhome/Makefile
@@ -12,7 +12,7 @@ PKG_MAINTAINER:=<https://github.com/rufengsuixing/luci-app-adguardhome>
 
 LUCI_TITLE:=LuCI app for AdGuardHome
 LUCI_PKGARCH:=all
-LUCI_DEPENDS:=+ca-certs +curl +wget-ssl +PACKAGE_$(PKG_NAME)_INCLUDE_binary:adguardhome
+LUCI_DEPENDS:=+ca-bundle +curl +wget-ssl +PACKAGE_$(PKG_NAME)_INCLUDE_binary:adguardhome
 LUCI_DESCRIPTION:=LuCI support for AdGuardHome
 
 define Package/$(PKG_NAME)/config
@@ -28,31 +28,6 @@ define Package/luci-app-adguardhome/conffiles
 /etc/config/AdGuardHome
 endef
 
-define Package/luci-app-adguardhome/postinst
-#!/bin/sh
-	/etc/init.d/AdGuardHome enable >/dev/null 2>&1
-	enable=$(uci get AdGuardHome.AdGuardHome.enabled 2>/dev/null)
-	if [ "$enable" == "1" ]; then
-		/etc/init.d/AdGuardHome reload
-	fi
-	rm -f /tmp/luci-indexcache
-	rm -f /tmp/luci-modulecache/*
-exit 0
-endef
-
-define Package/luci-app-adguardhome/prerm
-#!/bin/sh
-if [ -z "$${IPKG_INSTROOT}" ]; then
-     /etc/init.d/AdGuardHome disable
-     /etc/init.d/AdGuardHome stop
-uci -q batch <<-EOF >/dev/null 2>&1
-	delete ucitrack.@AdGuardHome[-1]
-	commit ucitrack
-EOF
-fi
-exit 0
-endef
-
 include ../../luci.mk
 
 # call BuildPackage - OpenWrt buildroot signature

--- a/adguardhome/Makefile
+++ b/adguardhome/Makefile
@@ -52,6 +52,11 @@ define Package/adguardhome/conffiles
 /etc/adguardhome.yaml
 endef
 
+define Package/adguardhome/postinst
+#!/bin/sh
+	/etc/init.d/AdGuardHome restart
+endef
+
 define Package/adguardhome/description
 Free and open source, powerful network-wide ads and trackers blocking DNS server.
 endef
